generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Company {
  id                     String   @id @default(cuid())
  name                   String
  website                String?
  industry               String?
  brandTone              String?
  colors                 String?
  logoUrl                String?
  notes                  String?
  employeeCount          Int?
  foundingYear           Int?
  websiteSystem          String?
  googleRating           Float?
  googleReviewCount      Int?
  location               String?
  description            String?
  shortPitch             String?
  usp                    String?
  positioning            String?
  businessModel          String?
  targetMarket           String?
  priceLevel             String?
  marketPosition         String?
  googleAddress          String?
  googleMapsLink         String?
  googleOpeningHours     String?
  sslEnabled             Boolean?
  websiteReachable       Boolean?
  avgLoadTime            Int?
  socialMedia            String?
  techStack              String?
  generalEmail           String?
  generalPhone           String?
  supportEmail           String?
  salesEmail             String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  projects               Project[]
  services               CompanyService[]
  contacts               CompanyContact[]
}

model CompanyService {
  id             String   @id @default(cuid())
  companyId      String
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  category       String
  title          String
  description    String?
  keywords       String?
  relevanceScore Float?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model CompanyContact {
  id              String   @id @default(cuid())
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  name            String
  role            String?
  email           String?
  phone           String?
  linkedIn        String?
  responsibilities String?
  isDecisionMaker Boolean  @default(false)
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Project {
  id             String    @id @default(cuid())
  companyId      String
  company        Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  name           String
  slug           String    @unique
  objective      String?
  targetAudience String?
  primaryCTA     String?
  status         String    @default("active")
  description   String?
  owner          String?
  startDate      DateTime?
  endDate        DateTime?
  technologies   String?
  previewUrl     String?
  contactPerson String?
  workflowAssignmentEnabled Boolean?
  preferredTemplateCategories String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  jobs           Job[]
  assets         Asset[]
  todos          Todo[]
  milestones     Milestone[]
  offers         Offer[]
  invoices       Invoice[]
  auditLogs      AuditLog[]
}

model Design {
  id            String    @id @default(cuid())
  name          String
  description   String?
  // Source
  sourceType    String    @default("web")
  sourceUrl     String?
  dribbbleId    String?   @unique
  dribbbleUser  String?
  // Kategorisierung
  category      String?
  industry      String?
  // Images (JSON array)
  images        String?
  coverImageUrl String?
  screenshotUrl String?
  // Status & Dedupe
  status        String    @default("saved")
  dedupeKey     String?   @unique
  // Bestehend
  tags          String?
  notes         String?
  blueprint     String?
  // Stats
  usesCount     Int       @default(0)
  lastUsedAt    DateTime?
  // Collections (JSON array for MVP)
  collectionIds String?
  // Timestamps
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Collection {
  id          String   @id @default(cuid())
  name        String
  description String?
  designIds   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ImportJob {
  id              String    @id @default(cuid())
  type            String
  inputData       String?
  status          String    @default("queued")
  resultDesignId  String?
  errorMessage    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  completedAt     DateTime?
}

model Template {
  id                 String    @id @default(cuid())
  name               String
  slug               String    @unique
  description        String?
  // Typ + Kategorie
  type               String    @default("section")
  category           String?
  // Tech-Stack
  framework          String    @default("nextjs")
  uiStack            String?
  // Bestehend (backward-compat fuer Local Templates)
  tags               String?
  layoutCode         String?
  placeholdersSchema String?
  previewImageUrl    String?
  // Source
  sourceMode         String    @default("local")
  repoFullName       String?
  defaultBranch      String?
  templateRootPath   String?
  pinnedPaths        String?
  // Preview
  readmePath         String?   @default("README.md")
  entryFile          String?
  // Sync
  syncStatus         String    @default("none")
  lastSyncAt         DateTime?
  lastCommitSha      String?
  syncErrorMessage   String?
  fileTreeSnapshot   String?
  // Stats
  usesCount          Int       @default(0)
  lastUsedAt         DateTime?
  // Timestamps
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model Job {
  id          String   @id @default(cuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  templateId  String?
  designId    String?
  status      String   @default("queued")
  steps       String?
  logs        String?
  inputJson   String?
  outputJson  String?
  previewUrl  String?
  scheduledAt DateTime?
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  assets      Asset[]
}

model Asset {
  id         String   @id @default(cuid())
  projectId  String?
  project    Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)
  jobId      String?
  job        Job?     @relation(fields: [jobId], references: [id], onDelete: SetNull)
  type       String
  storageKey String
  publicUrl  String?
  meta       String?
  createdAt  DateTime @default(now())
}

model Agent {
  id        String   @id @default(cuid())
  name      String
  type      String
  modelHint String?
  enabled   Boolean  @default(true)
  config    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model IntegrationSetting {
  id        String   @id @default(cuid())
  provider  String   @unique
  config    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AuditLog {
  id         String   @id @default(cuid())
  actor      String   @default("admin")
  entityType String
  entityId   String
  action     String
  payload    String?
  projectId  String?
  project    Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)
  summary    String?
  createdAt  DateTime @default(now())
}

model Todo {
  id          String    @id @default(cuid())
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  milestoneId String?
  milestone   Milestone? @relation(fields: [milestoneId], references: [id], onDelete: SetNull)
  title       String
  description String?
  status      String    @default("open")
  priority    String    @default("medium")
  dueAt       DateTime?
  assignedTo  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Milestone {
  id          String   @id @default(cuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  title       String
  description String?
  status      String   @default("planned")
  dueAt       DateTime?
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  todos       Todo[]
  offers      Offer[]
}

model Offer {
  id          String    @id @default(cuid())
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  milestoneId String?
  milestone   Milestone? @relation(fields: [milestoneId], references: [id], onDelete: SetNull)
  number      String
  status      String    @default("draft")
  amount      Float?
  pdfUrl      String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  invoices    Invoice[]
}

model Invoice {
  id         String   @id @default(cuid())
  projectId  String
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  offerId    String?
  offer      Offer?   @relation(fields: [offerId], references: [id], onDelete: SetNull)
  number     String
  status     String   @default("draft")
  amount     Float?
  dueAt      DateTime?
  paidAt     DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
